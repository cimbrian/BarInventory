@* Product card component for inventory capture *@
@using BarInventory.BarDB.Models

<div class="inventory-item @GetStatusClass()">
    <div class="item-header">
        <div>
            <div class="item-name">@Product.Brand @Product.Name</div>
            <div class="item-meta">@Product.SizeDescription â€¢ $@Product.UnitCost.ToString("0.00")</div>
        </div>
        <span class="item-badge @GetCategoryBadgeClass()">@CategoryName</span>
    </div>
    
    @if (ShowCounts)
    {
        <div class="d-flex justify-between align-center gap-sm mt-sm" style="flex-wrap: wrap;">
            <div>
                <span class="text-muted" style="font-size: 0.85rem;">Starting:</span>
                <strong>@StartingQuantity.ToString("0.0")</strong>
            </div>
            <div>
                <span class="text-muted" style="font-size: 0.85rem;">Received:</span>
                <strong>@ReceivedQuantity.ToString("0.0")</strong>
            </div>
            <div>
                <span class="text-muted" style="font-size: 0.85rem;">Current:</span>
                <strong style="color: var(--accent-blue);">@CurrentOnHand.ToString("0.0")</strong>
            </div>
            @if (ShowVariance && Math.Abs(Variance) > 0.1m)
            {
                <div>
                    <span class="text-muted" style="font-size: 0.85rem;">Variance:</span>
                    <strong class='@(Variance > 0 ? "text-danger" : "text-success")'>
                        @(Variance > 0 ? "+" : "")@Variance.ToString("0.0")
                    </strong>
                </div>
            }
        </div>
    }
    
    @if (ChildContent != null)
    {
        @ChildContent
    }
</div>

@code {
    [Parameter] public ProductsQueryResult Product { get; set; } = null!;
    [Parameter] public string CategoryName { get; set; } = "";
    [Parameter] public decimal StartingQuantity { get; set; }
    [Parameter] public decimal ReceivedQuantity { get; set; }
    [Parameter] public decimal CurrentOnHand { get; set; }
    [Parameter] public decimal Variance { get; set; }
    [Parameter] public bool IsCounted { get; set; }
    [Parameter] public bool ShowCounts { get; set; } = true;
    [Parameter] public bool ShowVariance { get; set; } = true;
    [Parameter] public RenderFragment? ChildContent { get; set; }
    
    private string GetStatusClass()
    {
        if (Math.Abs(Variance) > 2)
            return "variance-danger";
        if (Math.Abs(Variance) > 0.5m)
            return "variance-warning";
        if (IsCounted)
            return "counted";
        return "";
    }
    
    private string GetCategoryBadgeClass()
    {
        var name = CategoryName.ToLower();
        return name switch
        {
            "spirits" => "badge-liquor",
            "wine" => "badge-wine",
            "beer" => "badge-beer-bottle",
            "mixers" => "badge-mixer",
            _ => ""
        };
    }
}
